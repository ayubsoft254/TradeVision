{% extends 'base.html' %}
{% load static %}

{% block title %}KYC Verification - TradeVision{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center space-x-4">
                <a href="{% url 'accounts:profile' %}" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-arrow-left text-xl"></i>
                </a>
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 font-heading">KYC Verification</h1>
                    <p class="mt-2 text-gray-600">Complete your identity verification to unlock all platform features</p>
                </div>
            </div>
        </div>

        <!-- KYC Status Card -->
        <div class="mb-8">
            {% if profile.kyc_status == 'approved' %}
                <div class="bg-success-50 border border-success-200 rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle text-success-500 text-3xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-medium text-success-900">KYC Verification Approved</h3>
                            <p class="text-success-700">Your account is fully verified and you have access to all platform features.</p>
                        </div>
                    </div>
                </div>
            {% elif profile.kyc_status == 'pending' %}
                <div class="bg-warning-50 border border-warning-200 rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-clock text-warning-500 text-3xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-medium text-warning-900">KYC Verification Pending</h3>
                            <p class="text-warning-700">Your documents are under review. This process typically takes 24-48 hours.</p>
                        </div>
                    </div>
                </div>
            {% elif profile.kyc_status == 'rejected' %}
                <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <i class="fas fa-times-circle text-red-500 text-3xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-medium text-red-900">KYC Verification Rejected</h3>
                            <p class="text-red-700">Your verification was unsuccessful. Please resubmit your documents with correct information.</p>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- KYC Requirements -->
        <div class="bg-white rounded-lg shadow-md mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Verification Requirements</h3>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-900">Required Documents:</h4>
                        <ul class="space-y-2">
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-success-500 mr-2"></i>
                                Government-issued ID (Passport, National ID, Driver's License)
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-success-500 mr-2"></i>
                                Clear, readable document image
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-success-500 mr-2"></i>
                                All corners of the document visible
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-check text-success-500 mr-2"></i>
                                No expired documents
                            </li>
                        </ul>
                    </div>
                    
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-900">Document Guidelines:</h4>
                        <ul class="space-y-2">
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                File size: Maximum 5MB
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                Format: JPG, PNG, or PDF
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                Resolution: High quality, no blur
                            </li>
                            <li class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                Processing time: 24-48 hours
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- KYC Form -->
        {% if profile.kyc_status != 'approved' %}
        <form method="post" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}
            
            <!-- Personal Information -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="px-6 py-4 bg-primary-600 text-white">
                    <h3 class="text-lg font-semibold flex items-center">
                        <i class="fas fa-user mr-3"></i>
                        Personal Information
                    </h3>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- ID Number -->
                        <div>
                            <label for="id_number" class="block text-sm font-medium text-gray-700 mb-2">
                                ID Number <span class="text-red-500">*</span>
                            </label>
                            <input type="text" 
                                   name="id_number" 
                                   id="id_number"
                                   value="{{ profile.id_number }}"
                                   required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                                   placeholder="Enter your ID number">
                            <p class="mt-1 text-sm text-gray-500">Enter the number from your government-issued ID</p>
                        </div>

                        <!-- Date of Birth -->
                        <div>
                            <label for="date_of_birth" class="block text-sm font-medium text-gray-700 mb-2">
                                Date of Birth <span class="text-red-500">*</span>
                            </label>
                            <input type="date" 
                                   name="date_of_birth" 
                                   id="date_of_birth"
                                   value="{{ profile.date_of_birth|date:'Y-m-d' }}"
                                   required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                            <p class="mt-1 text-sm text-gray-500">Must match the date on your ID document</p>
                        </div>

                        <!-- City -->
                        <div>
                            <label for="city" class="block text-sm font-medium text-gray-700 mb-2">
                                City <span class="text-red-500">*</span>
                            </label>
                            <input type="text" 
                                   name="city" 
                                   id="city"
                                   value="{{ profile.city }}"
                                   required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                                   placeholder="Enter your city">
                        </div>

                        <!-- Postal Code -->
                        <div>
                            <label for="postal_code" class="block text-sm font-medium text-gray-700 mb-2">
                                Postal Code
                            </label>
                            <input type="text" 
                                   name="postal_code" 
                                   id="postal_code"
                                   value="{{ profile.postal_code }}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                                   placeholder="Enter postal code">
                        </div>
                    </div>

                    <!-- Address -->
                    <div class="mt-6">
                        <label for="address" class="block text-sm font-medium text-gray-700 mb-2">
                            Full Address <span class="text-red-500">*</span>
                        </label>
                        <textarea name="address" 
                                  id="address"
                                  rows="3"
                                  required
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                                  placeholder="Enter your complete address">{{ profile.address }}</textarea>
                        <p class="mt-1 text-sm text-gray-500">Your full residential address as it appears on official documents</p>
                    </div>
                </div>
            </div>

            <!-- Document Upload -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="px-6 py-4 bg-warning-600 text-white">
                    <h3 class="text-lg font-semibold flex items-center">
                        <i class="fas fa-upload mr-3"></i>
                        Document Upload
                    </h3>
                </div>
                
                <div class="p-6">
                    <!-- Current Document -->
                    {% if profile.id_document %}
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Current Document:</h4>
                            <div class="flex items-center">
                                <i class="fas fa-file-image text-gray-400 mr-2"></i>
                                <span class="text-sm text-gray-600">Document uploaded</span>
                                <a href="{{ profile.id_document.url }}" target="_blank" 
                                   class="ml-2 text-primary-600 hover:text-primary-800 text-sm">
                                    <i class="fas fa-external-link-alt mr-1"></i>
                                    View
                                </a>
                            </div>
                        </div>
                    {% endif %}

                    <!-- File Upload -->
                    <div x-data="{ dragOver: false }">
                        <label for="id_document" class="block text-sm font-medium text-gray-700 mb-2">
                            {% if profile.id_document %}
                                Replace ID Document <span class="text-red-500">*</span>
                            {% else %}
                                Upload ID Document <span class="text-red-500">*</span>
                            {% endif %}
                        </label>
                        
                        <div @dragover.prevent="dragOver = true"
                             @dragleave.prevent="dragOver = false"
                             @drop.prevent="dragOver = false; handleDrop($event)"
                             :class="{ 'border-primary-500 bg-primary-50': dragOver }"
                             class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center transition-colors duration-200 hover:border-gray-400">
                            
                            <input type="file" 
                                   name="id_document" 
                                   id="id_document"
                                   accept="image/*,.pdf"
                                   {% if not profile.id_document %}required{% endif %}
                                   class="hidden"
                                   @change="handleFileSelect($event)">
                            
                            <div class="space-y-2">
                                <i class="fas fa-cloud-upload-alt text-gray-400 text-3xl"></i>
                                <div>
                                    <label for="id_document" class="cursor-pointer">
                                        <span class="text-primary-600 hover:text-primary-800 font-medium">Click to upload</span>
                                        <span class="text-gray-500"> or drag and drop</span>
                                    </label>
                                </div>
                                <p class="text-sm text-gray-500">JPG, PNG or PDF (max. 5MB)</p>
                            </div>
                        </div>
                        
                        <!-- File Preview -->
                        <div id="file-preview" class="hidden mt-4 p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas fa-file text-gray-400 mr-2"></i>
                                    <span id="file-name" class="text-sm text-gray-600"></span>
                                </div>
                                <button type="button" onclick="clearFilePreview()" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Important Notes -->
                    <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-blue-600 mr-3 mt-1"></i>
                            <div>
                                <h4 class="text-sm font-medium text-blue-900">Important Notes:</h4>
                                <ul class="mt-2 text-sm text-blue-800 space-y-1">
                                    <li>• Ensure all information on the document is clearly visible</li>
                                    <li>• Document must be valid and not expired</li>
                                    <li>• Information must match what you've entered in the form</li>
                                    <li>• Processing may take 24-48 hours</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Terms and Submit -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="space-y-6">
                    <!-- Terms Acceptance -->
                    <div class="flex items-start">
                        <input type="checkbox" 
                               id="terms_accepted" 
                               required
                               class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded mt-1">
                        <label for="terms_accepted" class="ml-3 text-sm text-gray-600">
                            I confirm that all information provided is accurate and I agree to the 
                            <a href="{% url 'core:terms' %}" class="text-primary-600 hover:text-primary-800">Terms & Conditions</a>
                            and <a href="{% url 'core:privacy' %}" class="text-primary-600 hover:text-primary-800">Privacy Policy</a>.
                            <span class="text-red-500">*</span>
                        </label>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-500">
                            <span class="text-red-500">*</span> Required fields
                        </div>
                        
                        <div class="flex space-x-4">
                            <a href="{% url 'accounts:profile' %}" 
                               class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors duration-200 font-medium">
                                Cancel
                            </a>
                            
                            <button type="submit" 
                                    class="bg-primary-600 text-white px-8 py-3 rounded-lg hover:bg-primary-700 focus:ring-4 focus:ring-primary-200 transition-all duration-200 font-medium">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Submit for Verification
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        {% endif %}

        <!-- Benefits of KYC -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-6">Benefits of KYC Verification</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="w-16 h-16 bg-success-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-unlock text-success-600 text-2xl"></i>
                    </div>
                    <h4 class="font-medium text-gray-900 mb-2">Full Access</h4>
                    <p class="text-sm text-gray-600">Unlock all platform features and investment packages</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-money-bill-wave text-primary-600 text-2xl"></i>
                    </div>
                    <h4 class="font-medium text-gray-900 mb-2">Higher Limits</h4>
                    <p class="text-sm text-gray-600">Increased deposit and withdrawal limits</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-warning-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-shield-alt text-warning-600 text-2xl"></i>
                    </div>
                    <h4 class="font-medium text-gray-900 mb-2">Enhanced Security</h4>
                    <p class="text-sm text-gray-600">Additional security and fraud protection</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file) {
        showFilePreview(file);
    }
}

function handleDrop(event) {
    const files = event.dataTransfer.files;
    if (files.length > 0) {
        const file = files[0];
        document.getElementById('id_document').files = files;
        showFilePreview(file);
    }
}

function showFilePreview(file) {
    const preview = document.getElementById('file-preview');
    const fileName = document.getElementById('file-name');
    
    fileName.textContent = file.name;
    preview.classList.remove('hidden');
}

function clearFilePreview() {
    const preview = document.getElementById('file-preview');
    const fileInput = document.getElementById('id_document');
    
    preview.classList.add('hidden');
    fileInput.value = '';
}
</script>
{% endblock %}